var dynamicSelection=function(){"use strict";function e(e){var t=[],n=o.getItemValue(e.itemName);return""!=n&&(t=n.split(e.splitStr)),t}function t(t,n,i){var s=e(i);$.each(n,function(n,r){var c=$(r),a=c.text().match(i.replexRegex)[1];(n=$("<i></i>")).addClass("fa"),s.indexOf(a)>-1?n.addClass(i.selectedIcon):n.addClass(i.unselectedIcon),n.addClass("dynamic-selection-element-icon"),c.attr("key-str",a),c.addClass("dynamic-selection-element"),c.css("cursor","pointer"),c.html(n),c.on("click",function(){!function(t,n,i,s){var r=$(i),c="",a=r.hasClass(t.unselectedIcon),l=e(t);if(a){if(l.push(n),c=l.join(t.splitStr),t.noCLOB){var d=o.getStrByteLength(c);if(d>t.maxLength)return}o.setItemValue(t.itemName,c),r.removeClass(t.unselectedIcon),r.addClass(t.selectedIcon)}else o.removeElementFromArray(l,n),r.removeClass(t.selectedIcon),r.addClass(t.unselectedIcon),c=l.join(t.splitStr),o.setItemValue(t.itemName,c)}(i,a,n)}),c.contextmenu(function(e){var n=[];n.push({icon:i.selectedIcon,text:i.selectAllText,action:function(){$(t).find(".dynamic-selection-element-icon");var e="",n="",s="";$.each($(t).find(".dynamic-selection-element"),function(t,r){var c=$(r).attr("key-str");if(i.noCLOB){n+=s+c;if(o.getStrByteLength(n)>i.maxLength)return!1}e+=s+c,s=i.splitStr,$(r).children(".dynamic-selection-element-icon").addClass(i.selectedIcon),$(r).children(".dynamic-selection-element-icon").removeClass(i.unselectedIcon)}),o.setItemValue(i.itemName,e)}}),n.push({icon:i.unselectedIcon,text:i.unselectAllText,action:function(){var e=$(t).find(".dynamic-selection-element-icon");e.removeClass(i.selectedIcon),e.addClass(i.unselectedIcon),o.setItemValue(i.itemName,"")}}),function(e,t){t.preventDefault();var n=$("<div></div>");$.each(e,function(t,i){var s=$("<div></div>");t+1<e.length&&s.css("margin-bottom","4px"),s.css("cursor","pointer"),i.action&&s.on("click",function(){i.action()});var r=$("<span></span>");o.isDefinedAndNotNull(i.icon)&&(r.addClass("fa"),r.addClass(i.icon)),r.css("width","20px"),r.css("line-height","17px"),s.append(r);var c=$("<span></span>");c.css("line-height","16px"),c.css("vertical-align","top"),o.isDefinedAndNotNull(i.text)&&c.text(i.text),s.append(c),n.append(s)}),o.tooltip.show(n),o.tooltip.setPosition(t)}(n,e)}),$(document).on("touchstart click",function(e){c.is(e.target)||0!==c.has(e.target).length||o.tooltip.hide()})})}function n(e,n){try{var i=new RegExp(n.replexRegex);if("report"===n.type){t(e,$(e).find("td").filter(function(){return i.test($(this).text())}),n)}else{t(e,$(e).find(".dynamic-selection-element").filter(function(){return i.test($(this).text())}),n)}}catch(e){o.debug.error({module:"findePossibleItems",msg:"error while try to render selection items",err:e})}}var o={featureInfo:{name:"APEX Dynamic Selection",info:{scriptVersion:"1.0.1",utilVersion:"1.3.5",url:"https://github.com/RonnyWeiss",license:"MIT"}},isDefinedAndNotNull:function(e){return void 0!==e&&null!==e&&""!=e},isAPEX:function(){return"undefined"!=typeof apex},varType:function(e){if("object"!=typeof e)return typeof e;var t=[].constructor,n={}.constructor;return e.constructor===t?"array":e.constructor===n?"json":void 0},debug:{info:function(){if(o.isAPEX()){var e=0,t=[];for(var n in arguments)t[e]=arguments[n],e++;t.push(o.featureInfo),apex.debug.info.apply(this,t)}},error:function(){var e=0,t=[];for(var n in arguments)t[e]=arguments[n],e++;t.push(o.featureInfo),o.isAPEX()?apex.debug.error.apply(this,t):console.error.apply(this,t)}},setItemValue:function(e,t){o.isAPEX()?apex.item(e)&&0!=apex.item(e).node?apex.item(e).setValue(t):o.debug.error("Please choose a set item. Because the value ("+t+") can not be set on item ("+e+")"):o.debug.error("Error while try to call apex.item")},getItemValue:function(e){if(!e)return"";if(o.isAPEX()){if(apex.item(e)&&0!=apex.item(e).node)return apex.item(e).getValue();o.debug.error("Please choose a get item. Because the value could not be get from item("+e+")")}else o.debug.error("Error while try to call apex.item")},removeElementFromArray:function(e,t){if(o.varType(e)){if(t){for(var n=0;n<e.length;)e[n]==t?e.splice(n,1):++n;return e}o.debug.error("Error while try to remove element from array. No element to remove is given.")}else o.debug.error("Error while try to remove element from array. Given array is not an array.")},tooltip:{show:function(e,t,n){try{if(0==$("#dynToolTip").length){var o=$("<div></div>").attr("id","dynToolTip").css("max-width","400px").css("position","absolute").css("top","0px").css("left","0px").css("z-index","2000").css("background-color","rgba(240, 240, 240, 1)").css("padding","10px").css("display","block").css("top","0").css("overflow-wrap","break-word").css("word-wrap","break-word").css("-ms-hyphens","auto").css("-moz-hyphens","auto").css("-webkit-hyphens","auto").css("hyphens","auto");t&&o.css("background-color",t),n&&o.css("max-width",n),$("body").append(o)}else $("#dynToolTip").css("visibility","visible");$("#dynToolTip").html(e),$("#dynToolTip").find("*").css("max-width","100%").css("overflow-wrap","break-word").css("word-wrap","break-word").css("-ms-hyphens","auto").css("-moz-hyphens","auto").css("-webkit-hyphens","auto").css("hyphens","auto").css("white-space","normal"),$("#dynToolTip").find("img").css("object-fit","contain").css("object-position","50% 0%")}catch(e){console.error("Error while try to show tooltip"),console.error(e)}},setPosition:function(e){$("#dynToolTip").position({my:"left+6 top+6",of:e,collision:"flipfit"})},hide:function(){$("#dynToolTip").css("visibility","hidden")},remove:function(){$("#dynToolTip").remove()}},getStrByteLength:function(e){if(e){var t=encodeURIComponent(e).match(/%[89ABab]/g);return e.length+(t?t.length:0)}return 0}};return{initialize:function(e,t,i,s,r,c,a,l,d,u){o.debug.info({pThis:e,pUseType:t,pUsedRegex:i,pItemName:s,pSplitStr:r,pUnselectIcon:c,pSelectIcon:a,pUnselectAllText:l,pSelectAllText:d,pNoCLOB:u});var p={};p.this=e,p.type=t,p.itemName=s,p.splitStr=r,p.replexRegex=i,p.unselectedIcon=c,p.selectedIcon=a,p.unselectAllText=l,p.selectAllText=d,p.maxLength=4e3,p.noCLOB=!0,"N"===u&&(p.noCLOB=!1),$.each(e.affectedElements,function(e,t){n(t,p),$(t).on("apexafterrefresh",function(){n(t,p)}),$(t).on("gridpagechange",function(){n(t,p)})})}}}();